#!/usr/bin/env bash
# Check for binaries files in repo changes before committing

set -o 'pipefail'

cd "$(git rev-parse --show-toplevel)" || exit 1

files=$(git status --porcelain | cut -c4-)
# files=$(git ls-files --others --cached --exclude-standard)

[ -z "$files" ] && exit 0

matches=$(echo "$files" | xargs file --mime | grep 'charset=binary' | grep -v 'inode/x-empty')

if [ -n "$matches" ]; then
    gum log --level=error 'Binary files detected'
    echo "$matches"
    exit 1
fi

gum log --level=info 'No binary files detected'

exit 0
