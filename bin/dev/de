#!/usr/bin/env sh
# Execute cmd or sh "main" docker container

# wip
resolve_path=''

while getopts 'p' opt; do
  case ${opt} in
    p)
        resolve_path=1
        ;;
    ?)
      echo "Invalid option: -${OPTARG}."
      exit 1
      ;;
  esac
done

shift $((OPTIND - 1))

names=$(docker compose ps --format '{{.Names}}')

name=$(echo "$names" | grep -i 'fpm\|laravel.test')

# Use first if no matches
[ ! "$name" ] && name=$(echo "$names" | head -n 1)

if [ -t 0 ]; then
    flags='-it'
else
    flags='-i'
fi

docker exec "$flags" "$name" "${@:-bash}"
