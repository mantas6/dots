#!/usr/bin/env sh

set -e

add=true

while getopts 'in' opt; do
	case ${opt} in
	n)
		add=false
		;;
	?)
		exit 1
		;;
	esac
done

if [ -z "$(git status --porcelain)" ]; then
	exit 0
fi

if $add; then
	git add .
	git diff --staged
fi

last_msg=$(git log -1 --pretty=%B)

msg=$(gum write --show-line-numbers --height=5 --placeholder 'Commit message' --value="$last_msg")

echo "$msg"

git commit -m "$msg"
git pull --no-edit
git push
