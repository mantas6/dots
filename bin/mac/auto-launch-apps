#!/usr/bin/env bash

terminal() {
    open -n "$HOME/Applications/WezTerm.app"
}

browser() {
    open -n "/Applications/Google Chrome.app"
}

count_windows() {
    aerospace list-windows --workspace focused --count
}

await_windows() {
    while [ "$(count_windows)" -lt "$1" ]; do
        sleep 0.1
    done
}

workspace() {
    aerospace workspace "$1"

    local count
    count=$(count_windows)

    [ "$count" -ne 0 ] && return 1

    return 0
}

if workspace 1; then
    terminal
    browser
    await_windows 2
fi

if workspace 2; then
    open -n "/Applications/Microsoft Teams.app"
    open -n "/Applications/Microsoft Outlook.app"
    await_windows 2
fi

if workspace 3; then
    browser
    open -n "$HOME/Applications/Zen.app"
    await_windows 2
fi

if workspace 4; then
    browser
    open -n "/Applications/Safari.app"
    await_windows 2
fi

if workspace 5; then
    browser
    open -n "/Applications/Safari.app"
    await_windows 2
fi
